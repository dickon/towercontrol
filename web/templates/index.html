<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TowerControl</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
        rel="stylesheet" />
  <link rel="stylesheet" href="/static/style.css" />
</head>
<body class="bg-dark text-light">

  <!-- Navbar -->
  <nav class="navbar navbar-dark bg-black px-3">
    <span class="navbar-brand mb-0 h1">&#x1f3ef; TowerControl</span>
    <span id="statusBadge" class="badge bg-secondary">offline</span>
  </nav>

  <div class="container-fluid mt-3">
    <div class="row g-3">

      <!-- Left column: game capture -->
      <div class="col-lg-7">
        <div class="card bg-black border-secondary">
          <div class="card-header d-flex justify-content-between">
            <span>Game View</span>
            <small id="windowInfo" class="text-muted"></small>
          </div>
          <div class="card-body p-1 text-center position-relative">
            <canvas id="gameCanvas" class="game-canvas"></canvas>
            <div id="noImage" class="overlay-msg">No capture&mdash;is BlueStacks running?</div>
          </div>
        </div>

        <!-- OCR raw text -->
        <div class="card bg-black border-secondary mt-3">
          <div class="card-header">OCR Text</div>
          <div class="card-body" style="max-height:180px;overflow-y:auto">
            <pre id="ocrText" class="mb-0 text-info small"></pre>
          </div>
        </div>
      </div>

      <!-- Right column: controls & state -->
      <div class="col-lg-5">

        <!-- Controls -->
        <div class="card bg-black border-secondary">
          <div class="card-header">Controls</div>
          <div class="card-body">
            <div class="btn-group w-100 mb-2">
              <button class="btn btn-success btn-sm" onclick="api('start')">&#9654; Start</button>
              <button class="btn btn-warning btn-sm" onclick="api('pause')">&#10074;&#10074; Pause</button>
              <button class="btn btn-info btn-sm"    onclick="api('resume')">&#9654; Resume</button>
              <button class="btn btn-danger btn-sm"  onclick="api('stop')">&#9632; Stop</button>
            </div>
            <button class="btn btn-outline-light btn-sm w-100 mb-2"
                    onclick="api('scan')">&#128269; Full Scan</button>
            <div class="text-muted small">Click on the game image to inject a click.</div>
          </div>
        </div>

        <!-- Resources -->
        <div class="card bg-black border-secondary mt-3">
          <div class="card-header">Resources</div>
          <div class="card-body">
            <table class="table table-sm table-dark mb-0">
              <tbody id="resourcesTable"></tbody>
            </table>
          </div>
        </div>

        <!-- State -->
        <div class="card bg-black border-secondary mt-3">
          <div class="card-header">State</div>
          <div class="card-body">
            <dl class="row mb-0 small">
              <dt class="col-5">Screen</dt>
              <dd class="col-7" id="currentScreen">—</dd>
              <dt class="col-5">Wave</dt>
              <dd class="col-7" id="currentWave">—</dd>
              <dt class="col-5">Elements</dt>
              <dd class="col-7" id="elementCount">—</dd>
              <dt class="col-5">Tabs scanned</dt>
              <dd class="col-7" id="tabsScanned">—</dd>
              <dt class="col-5">Errors</dt>
              <dd class="col-7" id="errorCount">0</dd>
            </dl>
          </div>
        </div>

        <!-- Strategy params -->
        <div class="card bg-black border-secondary mt-3">
          <div class="card-header">Strategy Parameters</div>
          <div class="card-body" id="paramsContainer">
            <em class="text-muted">Loading…</em>
          </div>
        </div>

        <!-- Action log -->
        <div class="card bg-black border-secondary mt-3">
          <div class="card-header">Recent Actions</div>
          <div class="card-body" style="max-height:200px;overflow-y:auto">
            <ul id="actionLog" class="list-unstyled mb-0 small"></ul>
          </div>
        </div>

      </div>
    </div>
  </div>

  <script src="/static/app.js"></script>
</body>
</html>
